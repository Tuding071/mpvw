<!DOCTYPE html>
<html>
<head>
	<title>Intent specification</title>
	<link href="default.css" rel="stylesheet">
</head>
<body>
	<h2 id="intent">Intent</h2>

	<p>You can use an intent to launch the playback activity of mpv-android.</p>

	<p>package: <code>is.xyz.mpv</code><br>
	action: <code>android.intent.action.VIEW</code></p>
	<ul>
		<li>
			data: URI with schemes <code>rtmp, rtmps, rtp, rtsp, mms, mmst, mmsh, tcp, udp</code>
			(as supported by <a href="http://ffmpeg.org/ffmpeg-protocols.html" target="_blank" rel="noopener">FFmpeg</a>)<br>
			<i>or</i>
		</li>
		<li>
			data: URI with schemes <code>content, file, http, https</code><br>
			type: <code>video/*</code> or <code>audio/*</code><br>
			<i>or</i>
		</li>
		<li>
			data: URI with schemes <code>http, https</code> and file extension <code>mkv, mp4, webm, mov, flac, mp3, ogg, m3u, m3u8</code><br>
		</li>
	</ul>
	<p>If you need to force an URL to be opened in mpv even though file extension 
	may not match set the MIME type to <code>video/any</code>.<br>
	extras: <i>(optional)</i></p>
	<ul>
		<li>
			<code>decode_mode</code> (Byte): if set to 2, hardware decoding will be disabled
		</li>
		<li>
			<code>subs</code> (ParcelableArray of Uri): list of subtitle files to be added as additional tracks
		</li>
		<li>
			<code>subs.enable</code> (ParcelableArray of Uri): specifies which of the subtitles should be selected by default, subset of previous array
		</li>
		<li>
			<code>sub-file</code> (String): add one subtitle file to the list of external subtitles. This subtitle file is displayed by default
		</li>
		<li>
			<code>sub-files</code> (String): add multiple subtitle files separated by ;
		</li>
		<li>
			<code>position</code> (Int): starting point of video playback in milliseconds
		</li>
		<li>
			<code>user-agent</code> (String): specify user agent for HTTP streaming
		</li>
		<li>
			<code>referrer</code> (String): specify a referrer path or URL for HTTP requests
		</li>
		<li>
			<code>http-header-fields</code> (String): set custom HTTP fields when accessing HTTP stream. Fields are separated by commas <br>
			Escape commas inside a field's value with a backslash 
			<pre>Accept: */*,Accept-Language: en-RO\,en;q=0.9\,ro-RO;q=0.8\,ro;q=0.7\,en-US;q=0.6 </pre>
		</li>
		<li>
			<code>tls-verify</code> (String): verify peer certificates when using TLS 
		</li>
		<li>
			<code>title</code> (String): specify title to be used instead of filename
		</li>
		<li>
			<code>resume-playback</code> (String): specify if playback time should be resotred with "yes" or "no"
		</li>
		<li>
			<code>force-seekable</code> (String): If the player thinks that the media is not seekable (e.g. playing from a pipe,
	or it's an http stream with a server that doesn't support range requests), seeking will be disabled.
	This option can forcibly enable it. For seeks within the cache, there's a good chance of success.
		</li>
		<li>
			<code>cookies</code> (String): support cookies when making HTTP requests. Disabled by default.
		</li>
	</ul>

	<details>
		<summary>Examples</summary>
		<div style="margin-left: 1em;">
		<h5>Kotlin</h5>
		<pre>val intent = Intent(Intent.ACTION_VIEW)
intent.setDataAndType(Uri.parse("https://example.org/media.png"), "video/any")
intent.setPackage("is.xyz.mpv")
startActivity(intent)</pre>
		<h5>HTML (Chrome)</h5>
		<pre>&lt;a href="intent://example.org/media.png#Intent;type=video/any;package=is.xyz.mpv;scheme=https;end;"&gt;Click me&lt;/a&gt;</pre>
		<pre>&lt;a href="intent:https://example.com/abc#Intent;package=is.xyz.mpv;S.title=abc;S.http-header-fields=Cookie: key1=val1%3b 
key2=val2,Accept: */*,Accept-Language: en-RO%5c,en%3bq=0.9%5c,ro-RO%3bq=0.8%5c,ro%3bq=0.7%5c,en-US%3bq=0.6;end;"&gt;Click me&lt;/a&gt;</pre>
		<h4>Notice that semicolons, backslashes must be urlencoded (; => %3b and \ => %5c)</h4>
		<h5>Command line (e.g. adb or Termux)</h5>
		<pre>am start -a android.intent.action.VIEW -t video/any -p is.xyz.mpv -d "https://example.org/media.png" </pre>
		<pre>am start -a android.intent.action.VIEW -d "https://example.com/abc" --es "tls-verify" "no"  --es "title" "finally"
--es "user-agent" "Mozilla/5.0 (Linux; Android 10; potato) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Mobile Safari/537.36"
--es "http-header-fields" "Accept-Language: en-RO\\,en;q=0.9\\,ro-RO;q=0.8\\,ro;q=0.7\\,en-US;q=0.6,Accept: */*" </pre>
		</div>
		<h4>Notice that commas inside a header field's value are double escaped </h4>
	</details>

	<h2 id="result-intent">Result Intent</h2>

	<p>Once the activity exits mpv-android will deliver a result intent back to the invoker.<br>
	action: <code>is.xyz.mpv.MPVActivity.result</code><br>
	code:</p>
	<ul>
		<li><code>RESULT_CANCELED</code>: playback did not start due to an error</li>
		<li><code>RESULT_OK</code>: playback ended normally or user exited</li>
	</ul>
	<p>data: the same URI mpv was launched with<br>
	extras:</p>
	<ul>
		<li><code>position</code> (Int): last playback position in milliseconds, missing if playback finished normally</li>
		<li><code>duration</code> (Int): total media length in milliseconds, missing if playback finished normally</li>
	</ul>

	<h2 id="notes">Notes</h2>

	<p>This API was inspired by the counterpart in <a href="http://mx.j2inter.com/api" target="_blank" rel="noopener">MXPlayer</a>.<br>
	Note that only Java code is powerful enough to use the full features of this specification or receive result intents.</p>
</body>
</html>
